(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{184:function(e,t,n){"use strict";n.r(t),n.d(t,"MDXContext",(function(){return l})),n.d(t,"MDXProvider",(function(){return u})),n.d(t,"mdx",(function(){return x})),n.d(t,"useMDXComponents",(function(){return p})),n.d(t,"withMDXComponents",(function(){return m}));var a=n(0),i=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=i.a.createContext({}),m=function(e){return function(t){var n=p(t.components);return i.a.createElement(e,r({},t,{components:n}))}},p=function(e){var t=i.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=p(e.components);return i.a.createElement(l.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},b=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,r=e.parentName,d=c(e,["components","mdxType","originalType","parentName"]),l=p(n),m=a,u=l["".concat(r,".").concat(m)]||l[m]||h[m]||o;return n?i.a.createElement(u,s(s({ref:t},d),{},{components:n})):i.a.createElement(u,s({ref:t},d))}));function x(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=b;var d={};for(var s in t)hasOwnProperty.call(t,s)&&(d[s]=t[s]);d.originalType=e,d.mdxType="string"==typeof e?e:a,r[1]=d;for(var c=2;c<o;c++)r[c]=n[c];return i.a.createElement.apply(null,r)}return i.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"},75:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return d})),n.d(t,"toc",(function(){return s})),n.d(t,"default",(function(){return l}));var a=n(3),i=n(8),o=(n(0),n(184)),r={sidebar_position:4,keywords:"pallet design, intermediate, runtime"},d={unversionedId:"tutorials/Kitties/dispatchables-and-events",id:"tutorials/Kitties/dispatchables-and-events",isDocsHomePage:!1,title:"Part III: Dispatchables and Events",description:"Write a dispatchable function that creates a Kitty capable of emitting its associated Event.",source:"@site/docs/09-tutorials/01-Kitties/dispatchables-and-events.md",sourceDirName:"09-tutorials/01-Kitties",slug:"/tutorials/Kitties/dispatchables-and-events",permalink:"/substrate-how-to-guides/docs/tutorials/Kitties/dispatchables-and-events",editUrl:"https://github.com/substrate-developer-hub/substrate-how-to-guides/edit/main/docs/09-tutorials/01-Kitties/dispatchables-and-events.md",version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,keywords:"pallet design, intermediate, runtime"},sidebar:"tutorialSidebar",previous:{title:"Part II: Uniqueness, custom types and storage maps",permalink:"/substrate-how-to-guides/docs/tutorials/Kitties/create-kitties"},next:{title:"Part IV: Interacting with your Kitties",permalink:"/substrate-how-to-guides/docs/tutorials/Kitties/interacting-functions"}},s=[{value:"Learning outcomes",id:"learning-outcomes",children:[]},{value:"Overview",id:"overview",children:[]},{value:"Steps",id:"steps",children:[{value:"1. Public and private functions",id:"1-public-and-private-functions",children:[]},{value:"2. Write the <code>create_kitty</code> dispatchable",id:"2-write-the-create_kitty-dispatchable",children:[]},{value:"3. Write the <code>mint()</code> function",id:"3-write-the-mint-function",children:[]},{value:"4. Implement pallet Events",id:"4-implement-pallet-events",children:[]},{value:"5. Testing with PolkadotJS Apps",id:"5-testing-with-polkadotjs-apps",children:[]}]},{value:"Next steps",id:"next-steps",children:[]}],c={toc:s};function l(e){var t=e.components,n=Object(i.default)(e,["components"]);return Object(o.mdx)("wrapper",Object(a.default)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(o.mdx)("p",null,Object(o.mdx)("em",{parentName:"p"},"Write a dispatchable function that creates a Kitty capable of emitting its associated Event.")),Object(o.mdx)("h2",{id:"learning-outcomes"},"Learning outcomes"),Object(o.mdx)("p",null,"\u27a1\ufe0f Write a dispatchable function that updates storage items using a helper function."),Object(o.mdx)("p",null,"\u27a1\ufe0f Write a private helper function with error handling"),Object(o.mdx)("p",null,"\u27a1\ufe0f Write and use pallet Events."),Object(o.mdx)("p",null,"\u27a1\ufe0f Use PolkadotJS Apps UI to test pallet functionality."),Object(o.mdx)("h2",{id:"overview"},"Overview"),Object(o.mdx)("p",null,"In the previous section of this tutorial, we laid down the foundations geared to manage the ownership of our Kitties ","\u2014"," even though they don't really exist yet! In this part of the tutorial, we'll be putting these foundations to use\nby giving our pallet the ability to create a Kitty using the storage items we declared in the previous part\nof this tutorial. Breaking things down a little, we're going to:"),Object(o.mdx)("ul",null,Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("strong",{parentName:"li"},"write ",Object(o.mdx)("inlineCode",{parentName:"strong"},"create_kitty")),": a dispatchable or publicly callable function allowing an account to mint a Kitty."),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("strong",{parentName:"li"},"write ",Object(o.mdx)("inlineCode",{parentName:"strong"},"mint()")),": a helper function that updates our pallet's storage items and performs error checks, called by ",Object(o.mdx)("inlineCode",{parentName:"li"},"create_kitty"),"."),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("strong",{parentName:"li"},"include ",Object(o.mdx)("inlineCode",{parentName:"strong"},"Events")),": using FRAME's ",Object(o.mdx)("inlineCode",{parentName:"li"},"#[pallet::events]")," macro.")),Object(o.mdx)("p",null,"At the end of this part, we'll check that everything compiles without error and call our ",Object(o.mdx)("inlineCode",{parentName:"p"},"create_kitty")," extrinsic using the PolkadotJS Apps UI."),Object(o.mdx)("h2",{id:"steps"},"Steps"),Object(o.mdx)("h3",{id:"1-public-and-private-functions"},"1. Public and private functions"),Object(o.mdx)("p",null,"Before we dive right in, it's important to understand the pallet design decisions we'll be making around coding up our Kitty pallet's minting and ownership management\ncapabilities."),Object(o.mdx)("p",null,"As developers, we want to make sure the code we write is efficient and elegant. Oftentimes, optimizing for one optimizes for the other.\nThe way we're going to set up our pallet up to achieve elegance and efficiency will be to break-up the \"heavy lifting\" dispatchable\nfunctions or extrinsics into private helper functions. This improves code readability and reusability too. As we'll see, we can\ncreate private functions which can be called by multiple dispatchable functions without compromizing on security."),Object(o.mdx)("div",{className:"admonition admonition-info alert alert--info"},Object(o.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(o.mdx)("h5",{parentName:"div"},Object(o.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),Object(o.mdx)("div",{parentName:"div",className:"admonition-content"},Object(o.mdx)("p",{parentName:"div"},"Check out ",Object(o.mdx)("a",{parentName:"p",href:"docs/basics/basic-pallet-integration/"},"this how-to guide")," about writing and using helper functions to learn more."))),Object(o.mdx)("p",null,"In the next section, we'll go over what implementing this approach looks like. For our immediate purposes, let's paint the big picture of what this means for the logical flow of our pallet:"),Object(o.mdx)("p",null,Object(o.mdx)("strong",{parentName:"p"},Object(o.mdx)("inlineCode",{parentName:"strong"},"create_kitty"))),Object(o.mdx)("ul",null,Object(o.mdx)("li",{parentName:"ul"},"check the origin is signed"),Object(o.mdx)("li",{parentName:"ul"},"generate a random hash with the signing account"),Object(o.mdx)("li",{parentName:"ul"},"create a new Kitty object using the random hash"),Object(o.mdx)("li",{parentName:"ul"},"call a private ",Object(o.mdx)("inlineCode",{parentName:"li"},"mint()")," function"),Object(o.mdx)("li",{parentName:"ul"},"increment the nonce using ",Object(o.mdx)("inlineCode",{parentName:"li"},"increment_nonce()")," from the previous part")),Object(o.mdx)("p",null,Object(o.mdx)("strong",{parentName:"p"},Object(o.mdx)("inlineCode",{parentName:"strong"},"mint"))),Object(o.mdx)("ul",null,Object(o.mdx)("li",{parentName:"ul"},"check that the Kitty doesn't already exist"),Object(o.mdx)("li",{parentName:"ul"},"update storage with the new Kitty ID (for all Kitties and for the owner's account)"),Object(o.mdx)("li",{parentName:"ul"},"update the new total Kitty count for storage and the new owner's account"),Object(o.mdx)("li",{parentName:"ul"},"deposit an Event to signal that a Kitty has succesfully been created")),Object(o.mdx)("h3",{id:"2-write-the-create_kitty-dispatchable"},"2. Write the ",Object(o.mdx)("inlineCode",{parentName:"h3"},"create_kitty")," dispatchable"),Object(o.mdx)("p",null,"A dispatchable in FRAME always follows the same structure. All pallet dispatchables live under the ",Object(o.mdx)("inlineCode",{parentName:"p"},"#[pallet::call]")," macro which requires declaring the dispatchables section with ",Object(o.mdx)("inlineCode",{parentName:"p"}," impl<T: Config> Pallet<T> {}"),". Read the\n",Object(o.mdx)("a",{parentName:"p",href:"https://substrate.dev/docs/en/knowledgebase/runtime/macros#palletcall"},"documentation")," on these FRAME macros to learn how they work. All we need to know here is that they're a useful feature of FRAME that minimizes the code required to write for pallets to be properly integrated in a Substrate chain's runtime."),Object(o.mdx)("h4",{id:"weights"},"Weights"),Object(o.mdx)("p",null,"As per the requirement for ",Object(o.mdx)("inlineCode",{parentName:"p"},"#[pallet::call]")," described in the its documentation, every dispatchable function must have an associated weight to it. Weights are\nan important part of developing with Substrate as they provide safe-guards around the amount of computation to fit in a block at execution time.\n",Object(o.mdx)("a",{parentName:"p",href:"https://substrate.dev/docs/en/knowledgebase/learn-substrate/weight"},"Substrate's weighting system")," forces developers to think about the computational complexity each extrinsic carries before it is called so that\na node will account for it's worst case, avoiding a lagging the network with extrinsics that take longer than a single block time. Also, weights are intimately linked to the fee system for a signed extrinsic. Learn more about this ",Object(o.mdx)("a",{parentName:"p",href:"https://substrate.dev/docs/en/knowledgebase/runtime/fees"},"here"),"."),Object(o.mdx)("div",{className:"admonition admonition-tip alert alert--success"},Object(o.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(o.mdx)("h5",{parentName:"div"},Object(o.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Your turn!")),Object(o.mdx)("div",{parentName:"div",className:"admonition-content"},Object(o.mdx)("p",{parentName:"div"},"Use the template code for this section to\nhelp you write the ",Object(o.mdx)("inlineCode",{parentName:"p"},"create_kitty")," dispatchable.\nNo need to worry about the ",Object(o.mdx)("inlineCode",{parentName:"p"},"mint")," function, we'll be going over that in the next section."))),Object(o.mdx)("p",null,"Assuming you've correctly declared the macros required for the dispatchable, you should be able\nto prove to yourself that everything is working correctly by running:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-bash"},"cargo build -p pallet-kitties\n")),Object(o.mdx)("h3",{id:"3-write-the-mint-function"},"3. Write the ",Object(o.mdx)("inlineCode",{parentName:"h3"},"mint()")," function"),Object(o.mdx)("p",null,"As seen when we wrote ",Object(o.mdx)("inlineCode",{parentName:"p"},"create_kitty")," in the previous section, we'll need ",Object(o.mdx)("inlineCode",{parentName:"p"},"mint")," for\nwriting our new unique Kitty object to the various storage items declared in part II of this tutorial."),Object(o.mdx)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(o.mdx)("h5",{parentName:"div"},Object(o.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"A quick recap of our storage items")),Object(o.mdx)("div",{parentName:"div",className:"admonition-content"},Object(o.mdx)("ul",{parentName:"div"},Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("strong",{parentName:"li"},Object(o.mdx)("inlineCode",{parentName:"strong"},"<Kitties<T>>")),": Stores a Kitty's unique traits and price, by storing the Kitty object."),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("strong",{parentName:"li"},Object(o.mdx)("inlineCode",{parentName:"strong"},"<KittyOwner<T>>")),": Keeps track of what accounts own what Kitty."),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("strong",{parentName:"li"},Object(o.mdx)("inlineCode",{parentName:"strong"},"<AllKittiesArray<T>>")),": An index to track of all Kitties."),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("strong",{parentName:"li"},Object(o.mdx)("inlineCode",{parentName:"strong"},"<AllKittiesCount<T>>")),": Stores the total amount of Kitties in existence."),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("strong",{parentName:"li"},Object(o.mdx)("inlineCode",{parentName:"strong"},"<AllKittiesIndex<T>>")),": Keeps track of all the Kitties."),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("strong",{parentName:"li"},Object(o.mdx)("inlineCode",{parentName:"strong"},"<OwnedKittiesArray<T>>")),": Keep track of who a Kitty is owned by."),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("strong",{parentName:"li"},Object(o.mdx)("inlineCode",{parentName:"strong"},"<OwnedKittiesCount<T>>")),": Keeps track of the total amount of Kitties owned."),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("strong",{parentName:"li"},Object(o.mdx)("inlineCode",{parentName:"strong"},"<OwnedKittiesIndex<T>>")),": Keeps track of all owned Kitties by index.\n:::")),Object(o.mdx)("hr",{parentName:"div"}),Object(o.mdx)("p",{parentName:"div"},"Let's get right to it. Our ",Object(o.mdx)("inlineCode",{parentName:"p"},"mint()")," function will take the following arguments:"),Object(o.mdx)("ul",{parentName:"div"},Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("strong",{parentName:"li"},Object(o.mdx)("inlineCode",{parentName:"strong"},"to")),": of type ",Object(o.mdx)("inlineCode",{parentName:"li"},"T::AccountId")),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("strong",{parentName:"li"},Object(o.mdx)("inlineCode",{parentName:"strong"},"kitty_id")),": of type ",Object(o.mdx)("inlineCode",{parentName:"li"},"T::Hash")),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("strong",{parentName:"li"},Object(o.mdx)("inlineCode",{parentName:"strong"},"new_kitty")),": of type ",Object(o.mdx)("inlineCode",{parentName:"li"},"Kitty<T::Hash, T::Balance>"))),Object(o.mdx)("p",{parentName:"div"},"And it will return ",Object(o.mdx)("inlineCode",{parentName:"p"},"DispatchResult"),"."))),Object(o.mdx)("p",null,"In ",Object(o.mdx)("inlineCode",{parentName:"p"},"create_kitty")," our return was of type ",Object(o.mdx)("inlineCode",{parentName:"p"},"DispatchResultWithPostInfo"),". Since ",Object(o.mdx)("inlineCode",{parentName:"p"},"mint()")," is a helper for ",Object(o.mdx)("inlineCode",{parentName:"p"},"create_kitty"),", we don't need to overwrite ",Object(o.mdx)("inlineCode",{parentName:"p"},"PostDispatchInfo"),",\nso we can use a return type of ",Object(o.mdx)("a",{parentName:"p",href:"https://substrate.dev/rustdocs/v3.0.0/frame_support/dispatch/type.DispatchResult.html"},Object(o.mdx)("inlineCode",{parentName:"a"},"DispatchResult"))," ","\u2014"," its unaugmented version.\n:::"),Object(o.mdx)("div",{className:"admonition admonition-tip alert alert--success"},Object(o.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(o.mdx)("h5",{parentName:"div"},Object(o.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Your turn!")),Object(o.mdx)("div",{parentName:"div",className:"admonition-content"},Object(o.mdx)("p",{parentName:"div"},"Write out the skeleton of the ",Object(o.mdx)("inlineCode",{parentName:"p"},"mint()")," function."),Object(o.mdx)("p",{parentName:"div"},Object(o.mdx)("strong",{parentName:"p"},"HINT:")," it will go towards the bottom of your pallet, under ",Object(o.mdx)("inlineCode",{parentName:"p"},"impl<T: Config> Pallet<T> {}")))),Object(o.mdx)("p",null,"Now that we have the skeleton of the ",Object(o.mdx)("inlineCode",{parentName:"p"},"mint()")," function, let's go over what to write inside it."),Object(o.mdx)("p",null,"The first thing we'll need to do is to check that the Kitty being passed in doesn't already exist. To accomplish this, we can use the built-in ",Object(o.mdx)("inlineCode",{parentName:"p"},"ensure!")," macro that Rust provides us, along with\na method provided by FRAME's ",Object(o.mdx)("inlineCode",{parentName:"p"},"StorageMap")," called ",Object(o.mdx)("inlineCode",{parentName:"p"},"contains_key"),"."),Object(o.mdx)("blockquote",null,Object(o.mdx)("p",{parentName:"blockquote"},Object(o.mdx)("a",{parentName:"p",href:"https://substrate.dev/rustdocs/v3.0.0/frame_support/storage/trait.StorageMap.html#tymethod.contains_key"},Object(o.mdx)("inlineCode",{parentName:"a"},"contains_key"))," will check if a key matches the Hash value in an existing Kitty object. And\n",Object(o.mdx)("inlineCode",{parentName:"p"},"ensure!")," will return an error if the storage map already\ncontains the given Kitty ID.")),Object(o.mdx)("p",null,"The check can be written like this:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-rust"},'ensure!( !<SomeStorageMapStruct<T>>::contains_key(some_key),\n"SomeStorageMapStruct already contains_key");\n')),Object(o.mdx)("p",null,"Once we've done the check, we can proceed with updating our storage items with the Kitty object passed into our function call. To do this, we'll make use of\nthe ",Object(o.mdx)("a",{parentName:"p",href:"https://substrate.dev/rustdocs/v3.0.0/frame_support/storage/trait.StorageMap.html#tymethod.insert"},Object(o.mdx)("inlineCode",{parentName:"a"},"insert"))," method from our StorageMap API, using the following pattern:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-rust"},"<SomeStorageMapStruct<T>>::insert(some_key, new_key);\n")),Object(o.mdx)("p",null,"Finally, we'll need to compute a few variables to update our storage items which keep track of:"),Object(o.mdx)("ul",null,Object(o.mdx)("li",{parentName:"ul"},"the indices and count for all Kitties."),Object(o.mdx)("li",{parentName:"ul"},"the indices and count of owned Kitties.")),Object(o.mdx)("p",null,"All this requires us to do is add 1 to the current values held by ",Object(o.mdx)("inlineCode",{parentName:"p"},"<AllKittiesCount<T>>")," and ",Object(o.mdx)("inlineCode",{parentName:"p"},"<OwnedKittiesCount<T>>"),". We can use the same pattern as we did in the previous part when we created ",Object(o.mdx)("inlineCode",{parentName:"p"},"increment_nonce"),", using Rust's ",Object(o.mdx)("inlineCode",{parentName:"p"},"checked_add")," and ",Object(o.mdx)("inlineCode",{parentName:"p"},"ok_or"),":"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-rust"},'let new_value = previous_value.checked_add(1).ok_or("Overflow error!");\n')),Object(o.mdx)("div",{className:"admonition admonition-tip alert alert--success"},Object(o.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(o.mdx)("h5",{parentName:"div"},Object(o.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Your turn!")),Object(o.mdx)("div",{parentName:"div",className:"admonition-content"},Object(o.mdx)("p",{parentName:"div"},'Write the remaining "storage-write" operations\nfor the ',Object(o.mdx)("inlineCode",{parentName:"p"},"mint()")," function."),Object(o.mdx)("p",{parentName:"div"},Object(o.mdx)("strong",{parentName:"p"},"HINT:")," There's 8 in total. And ",Object(o.mdx)("inlineCode",{parentName:"p"},"StorageValue")," has a different method than ",Object(o.mdx)("inlineCode",{parentName:"p"},"StorageMap")," to update its storage instance ","\u2014"," have a glance at the ",Object(o.mdx)("a",{parentName:"p",href:"https://substrate.dev/rustdocs/v3.0.0/frame_support/storage/types/struct.StorageValue.html#method.put"},"methods it exposes")," to learn more."))),Object(o.mdx)("h3",{id:"4-implement-pallet-events"},"4. Implement pallet Events"),Object(o.mdx)("p",null,"In Substrate, even though a transaction may be finalized, it does not necessarily imply that the function executed by that transaction fully succeeded."),Object(o.mdx)("p",null,'To verify this, we make our pallet emit an Event at the end of the function. This not only report the success of a function\'s execution, but also tells the "off-chain world" that some particular state transition has happened.'),Object(o.mdx)("p",null,"FRAME helps us easily manage and declare our pallet's events using the ",Object(o.mdx)("a",{parentName:"p",href:"https://crates.parity.io/frame_support/attr.pallet.html#event-palletevent-optional"},Object(o.mdx)("inlineCode",{parentName:"a"},"#[pallet::event]"))," macro. With FRAME macros, events are just an enum declared like this:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-rust"},"#[pallet::event]\n#[pallet::generate_deposit(pub(super) fn deposit_event)]\npub enum Event<T: Config>{\n    /// A function succeeded. [time, day]\n    Success(T::Time, T::Day),\n}\n")),Object(o.mdx)("p",null,"As you can see in the above snippet, we use ",Object(o.mdx)("inlineCode",{parentName:"p"},"#[pallet::generate_deposit(pub(super) fn deposit_event)]")," which allows us to deposit a\nspecifc event using pattern below:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-rust"},"Self::deposit_event(Event::Success(var_time, var_day));\n")),Object(o.mdx)("p",null,"In order to use events inside our pallet, we need to add the ",Object(o.mdx)("inlineCode",{parentName:"p"},"Event")," type to our pallet's configuration trait, ",Object(o.mdx)("inlineCode",{parentName:"p"},"Config"),". Additionally ","\u2014"," just as\nwhen adding any type to our pallet's ",Object(o.mdx)("inlineCode",{parentName:"p"},"Config")," trait ","\u2014"," we need to let our runtime know about it. This pattern is the same as when\nwe added the ",Object(o.mdx)("inlineCode",{parentName:"p"},"KittyRandomness")," type in ",Object(o.mdx)("a",{parentName:"p",href:"/docs/Tutorials/Kitties/create-kitties#2-implementing-randomness"},"part II of this tutorial"),"."),Object(o.mdx)("div",{className:"admonition admonition-tip alert alert--success"},Object(o.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(o.mdx)("h5",{parentName:"div"},Object(o.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Your turn!")),Object(o.mdx)("div",{parentName:"div",className:"admonition-content"},Object(o.mdx)("p",{parentName:"div"},"Set your pallet up for handling events by adding the ",Object(o.mdx)("inlineCode",{parentName:"p"},"Event")," type to both your pallet's configuration trait and runtime implementation.\nThen, write an event for ",Object(o.mdx)("inlineCode",{parentName:"p"},"mint()")," with the appropriate return types."),Object(o.mdx)("p",{parentName:"div"},Object(o.mdx)("strong",{parentName:"p"},"HINT #1:")," Once all storage updates have been made in ",Object(o.mdx)("inlineCode",{parentName:"p"},"mint()"),", we want to inform the external world which account\nhas created the Kitty, as well as what that Kitty's ID is."),Object(o.mdx)("p",{parentName:"div"},Object(o.mdx)("strong",{parentName:"p"},"HINT #2:")," The ubiquitous Event type is: ",Object(o.mdx)("inlineCode",{parentName:"p"},"type Event: From<Event<Self>> + IsType<<Self as frame_system::Config>::Event>;"),"."))),Object(o.mdx)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(o.mdx)("h5",{parentName:"div"},Object(o.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Notice that each event deposit is meant to be informative which is why it carries the various types associated with it.")),Object(o.mdx)("div",{parentName:"div",className:"admonition-content"},Object(o.mdx)("p",{parentName:"div"},"It's good practice to get in the habit of documenting your event declarations so that your code is easy to read. It is convention to document events as such:"),Object(o.mdx)("p",{parentName:"div"},Object(o.mdx)("inlineCode",{parentName:"p"},"/// Description. [types]")),Object(o.mdx)("p",{parentName:"div"},"Learn more about events ",Object(o.mdx)("a",{parentName:"p",href:"https://substrate.dev/docs/en/knowledgebase/runtime/events"},"here"),"."))),Object(o.mdx)("p",null,"Now's a good time to see if your chain can compile. Instead of only checking if your pallet compiles, run the following command to see if everything can build:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-rust"},"cargo build --release\n")),Object(o.mdx)("h3",{id:"5-testing-with-polkadotjs-apps"},"5. Testing with PolkadotJS Apps"),Object(o.mdx)("p",null,"Assuming that you successfully built your chain, let's run it and use the PolkadotJS Apps UI to interact with it."),Object(o.mdx)("p",null,"In your chain's project directory, run:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-bash"},"./target/release/kitties-node --tmp --dev\n")),Object(o.mdx)("p",null,"By doing this, we're specifying to run a temporary chain in developer mode, so as not to need to purge storage each time we want to start a fresh chain."),Object(o.mdx)("p",null,"Assuming that blocks are being finalized (which you should be able to see from your terminal in which you ran the above command), head over to ",Object(o.mdx)("a",{parentName:"p",href:"https://polkadot.js.org/apps/#/explorer"},"Poladot.js Apps"),"."),Object(o.mdx)("p",null,Object(o.mdx)("strong",{parentName:"p"},"Follow these steps:")),Object(o.mdx)("ol",null,Object(o.mdx)("li",{parentName:"ol"},'Check that you\'re connected to Local Node, under "Development".'),Object(o.mdx)("li",{parentName:"ol"},'Tell the UI about your custom types. This requires you to paste them into the "',Object(o.mdx)("em",{parentName:"li"},"Settings"),'" -> "',Object(o.mdx)("em",{parentName:"li"},"Developers"),'" section.'),Object(o.mdx)("li",{parentName:"ol"},'Go to "',Object(o.mdx)("em",{parentName:"li"},"Developer"),'" -> "',Object(o.mdx)("em",{parentName:"li"},"Extrinsics"),'". Paste this in the JSON code editor:')),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-json"},'{\n  "AccountInfo": {\n    "nonce": "Index",\n    "consumers": "RefCount",\n    "providers": "RefCount",\n    "data": "AccountData"\n  },\n  "Address": "MultiAddress",\n  "LookupSource": "AccountId",\n  "Gender": {\n    "_enum": ["male", "female"]\n  },\n  "Kitty": {\n    "id": "H256",\n    "dna": "H256",\n    "price": "Balance",\n    "gender": "Gender"\n  }\n}\n')),Object(o.mdx)("p",null,"The reason we need this is because we created types that PolkadotJS Apps isn't designed to read. By adding them, it's capable to properly decode each of our storage items that use custom types."),Object(o.mdx)("ol",{start:3},Object(o.mdx)("li",{parentName:"ol"},"Submit a signed extrinsic using ",Object(o.mdx)("em",{parentName:"li"},"substrateKitties")," by calling the ",Object(o.mdx)("inlineCode",{parentName:"li"},"createKitty()")," dispatchable."),Object(o.mdx)("li",{parentName:"ol"},'Check for the associated event by going to "',Object(o.mdx)("em",{parentName:"li"},"Network"),'" -> "',Object(o.mdx)("em",{parentName:"li"},"Explorer"),'". You should be able to see the event emitted and query its block details.'),Object(o.mdx)("li",{parentName:"ol"},"Check your newly created Kitty's details by going to \"",Object(o.mdx)("em",{parentName:"li"},"Developer"),'" -> "',Object(o.mdx)("em",{parentName:"li"},"Chain State"),'". Select the ',Object(o.mdx)("em",{parentName:"li"},"substrateKitties")," pallet and query ",Object(o.mdx)("inlineCode",{parentName:"li"},"Kitties(Hash): Kitty"),".")),Object(o.mdx)("p",null,"You should be able to see your newly minted Kitty (or at least what it's made of!):"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-json"},"substrateKitties.kitties: Kitty\n[\n    [\n      0xf78c3e9c10498c350d639a10fa773cb878b85bf2c5989e38f8b1cd5c0bafb7ee\n    ],\n    {\n      id: 0xf78c3e9c10498c350d639a10fa773cb878b85bf2c5989e38f8b1cd5c0bafb7ee,\n      dna: 0xf78c3e9c10498c350d639a10fa773cb878b85bf2c5989e38f8b1cd5c0bafb7ee,\n      price: 0,\n      gender: female\n    }\n  ],\n")),Object(o.mdx)("ol",{start:5},Object(o.mdx)("li",{parentName:"ol"},"Check that other storage items correctly reflect the creation of additional Kitties.")),Object(o.mdx)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(o.mdx)("h5",{parentName:"div"},Object(o.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Congratulations!")),Object(o.mdx)("div",{parentName:"div",className:"admonition-content"},Object(o.mdx)("p",{parentName:"div"},"You're pretty much able to take it from here at this point! We've learnt how to implement the key parts of what powers a FRAME pallet and how to put them to use. All part IV of this tutorial covers is adding more capabilities to our pallet by taking what we've learnt in this part."),Object(o.mdx)("p",{parentName:"div"},"To recap, in this part of the tutorial you've learnt how:"),Object(o.mdx)("ul",{parentName:"div"},Object(o.mdx)("li",{parentName:"ul"},"To distinguish between implementing a dispatchable function and a private helper function."),Object(o.mdx)("li",{parentName:"ul"},"To use ",Object(o.mdx)("inlineCode",{parentName:"li"},"#[pallet::call]")," and ",Object(o.mdx)("inlineCode",{parentName:"li"},"#[pallet::events]"),"."),Object(o.mdx)("li",{parentName:"ul"},"To do basic error checking."),Object(o.mdx)("li",{parentName:"ul"},"To update values in storage."),Object(o.mdx)("li",{parentName:"ul"},"To implement events and use them in a function."),Object(o.mdx)("li",{parentName:"ul"},"To query storage items and chain state using the PolkadotJS Apps UI.")))),Object(o.mdx)("h2",{id:"next-steps"},"Next steps"),Object(o.mdx)("ul",null,Object(o.mdx)("li",{parentName:"ul"},"Create a dispatchable to buy a Kitty"),Object(o.mdx)("li",{parentName:"ul"},"Create a dispatchable to transfer a Kitty"),Object(o.mdx)("li",{parentName:"ul"},"Create a dispatchable to breed two Kitties")))}l.isMDXComponent=!0}}]);