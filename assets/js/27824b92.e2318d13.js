(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{186:function(e,t,n){"use strict";n.r(t),n.d(t,"MDXContext",(function(){return m})),n.d(t,"MDXProvider",(function(){return u})),n.d(t,"mdx",(function(){return x})),n.d(t,"useMDXComponents",(function(){return p})),n.d(t,"withMDXComponents",(function(){return l}));var a=n(0),i=n.n(a);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var m=i.a.createContext({}),l=function(e){return function(t){var n=p(t.components);return i.a.createElement(e,r({},t,{components:n}))}},p=function(e){var t=i.a.useContext(m),n=t;return e&&(n="function"==typeof e?e(t):d(d({},t),e)),n},u=function(e){var t=p(e.components);return i.a.createElement(m.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return i.a.createElement(i.a.Fragment,{},t)}},b=i.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,r=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),m=p(n),l=a,u=m["".concat(r,".").concat(l)]||m[l]||h[l]||o;return n?i.a.createElement(u,d(d({ref:t},s),{},{components:n})):i.a.createElement(u,d({ref:t},s))}));function x(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=b;var s={};for(var d in t)hasOwnProperty.call(t,d)&&(s[d]=t[d]);s.originalType=e,s.mdxType="string"==typeof e?e:a,r[1]=s;for(var c=2;c<o;c++)r[c]=n[c];return i.a.createElement.apply(null,r)}return i.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"},45:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return s})),n.d(t,"toc",(function(){return d})),n.d(t,"default",(function(){return m}));var a=n(3),i=n(8),o=(n(0),n(186)),r={sidebar_position:3,keywords:"pallet design, intermediate, runtime",code:"code/kitties-tutorial/02-create-kitties.rs"},s={unversionedId:"tutorials/Kitties/create-kitties",id:"tutorials/Kitties/create-kitties",isDocsHomePage:!1,title:"Part II: Uniqueness, custom types and storage maps",description:"_In this part of the tutorial, we'll build out the components of our pallet",source:"@site/docs/09-tutorials/01-Kitties/create-kitties.md",sourceDirName:"09-tutorials/01-Kitties",slug:"/tutorials/Kitties/create-kitties",permalink:"/substrate-how-to-guides/docs/tutorials/Kitties/create-kitties",editUrl:"https://github.com/substrate-developer-hub/substrate-how-to-guides/edit/main/docs/09-tutorials/01-Kitties/create-kitties.md",version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,keywords:"pallet design, intermediate, runtime",code:"code/kitties-tutorial/02-create-kitties.rs"},sidebar:"tutorialSidebar",previous:{title:"Part I: Basic set-up",permalink:"/substrate-how-to-guides/docs/tutorials/Kitties/basic-setup"},next:{title:"Part III: Dispatchables and Events",permalink:"/substrate-how-to-guides/docs/tutorials/Kitties/dispatchables-and-events"}},d=[{value:"Learning outcomes",id:"learning-outcomes",children:[]},{value:"Overview",id:"overview",children:[]},{value:"Steps",id:"steps",children:[{value:"1. Create the Kitty struct",id:"1-create-the-kitty-struct",children:[]},{value:"2. Implement on-chain randomness",id:"2-implement-on-chain-randomness",children:[]},{value:"3. Include storage items",id:"3-include-storage-items",children:[]}]},{value:"Next steps",id:"next-steps",children:[]}],c={toc:d};function m(e){var t=e.components,n=Object(i.default)(e,["components"]);return Object(o.mdx)("wrapper",Object(a.default)({},c,n,{components:t,mdxType:"MDXLayout"}),Object(o.mdx)("p",null,Object(o.mdx)("em",{parentName:"p"},"In this part of the tutorial, we'll build out the components of our pallet\nneeded to manage the creation and ownership of our Kitties.")),Object(o.mdx)("h2",{id:"learning-outcomes"},"Learning outcomes"),Object(o.mdx)("p",null,"\u27a1\ufe0f Writing a custom struct and using it in storage."),Object(o.mdx)("p",null,"\u27a1\ufe0f Creating a custom type and implementing it for your pallet's ",Object(o.mdx)("inlineCode",{parentName:"p"},"Config")," trait."),Object(o.mdx)("p",null,"\u27a1\ufe0f Using the Randomness trait in a helper function."),Object(o.mdx)("p",null,"\u27a1\ufe0f Adding and using ",Object(o.mdx)("inlineCode",{parentName:"p"},"StorageMap")," items to a pallet."),Object(o.mdx)("h2",{id:"overview"},"Overview"),Object(o.mdx)("p",null,"This part of the tutorial dives into some pillar concepts for developing pallets with FRAME. Ontop of learning\nhow to use existing types and traits, you'll learn how create your own (",Object(o.mdx)("em",{parentName:"p"},"FRAME doesn't have a concept of Gender!"),"). At the end\nof this part, you will have implemented all remaining storage items according to the logic outlined for the Substrate Kitty dApp\n",Object(o.mdx)("a",{parentName:"p",href:"/overview"},"in the overview of this tutorial"),"."),Object(o.mdx)("h2",{id:"steps"},"Steps"),Object(o.mdx)("h3",{id:"1-create-the-kitty-struct"},"1. Create the Kitty struct"),Object(o.mdx)("h4",{id:"a-what-information-to-include"},"A. What information to include"),Object(o.mdx)("p",null,"Structs are a useful tool to help carry information that corresponds to the same object.\nFor our purposes, instead of using separate storage items for each of our Kitty traits,\nwe can store this information in a single struct. This comes in handy when trying to optimize\nfor storage reads and writes. Let's first go over what information a single Kitty carries:"),Object(o.mdx)("ul",null,Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("strong",{parentName:"li"},Object(o.mdx)("inlineCode",{parentName:"strong"},"id")),": a unique hash to identify each Kitty."),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("strong",{parentName:"li"},Object(o.mdx)("inlineCode",{parentName:"strong"},"dna")),": the hash used to identify the DNA of a Kitty, which corresponds to its unique features.\nDNA is also used to breed new Kitties and to keep track of different Kitty generations."),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("strong",{parentName:"li"},Object(o.mdx)("inlineCode",{parentName:"strong"},"price")),": this is a balance that corresponds to the amount needed to buy a Kitty and\ndetermined by its owner."),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("strong",{parentName:"li"},Object(o.mdx)("inlineCode",{parentName:"strong"},"gender")),": an enum that can be either ",Object(o.mdx)("inlineCode",{parentName:"li"},"Male")," or ",Object(o.mdx)("inlineCode",{parentName:"li"},"Female"),".")),Object(o.mdx)("h4",{id:"b-writing-out-the-struct"},"B. Writing out the struct"),Object(o.mdx)("p",null,"Now that we know what to include in our Kitty struct, let's recap the basics of declaring a struct."),Object(o.mdx)("p",null,"A struct has the following format:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-rust"},"#[derive(Clone, Encode, Decode, Default, PartialEq)]\npub struct SomeStruct<SomeType1, SomeType2> {\n    value_1: SomeType1,\n    value_2: SomeType2,\n}\n")),Object(o.mdx)("p",null,"We use the derive macro to include ",Object(o.mdx)("a",{parentName:"p",href:"https://substrate.dev/rustdocs/latest/sp_std/prelude/index.html#traits"},"various helper traits")," for using our struct."),Object(o.mdx)("h4",{id:"c-adding-the-hash-dependency"},"C. Adding the ",Object(o.mdx)("inlineCode",{parentName:"h4"},"Hash")," dependency"),Object(o.mdx)("p",null,"Looking at the items of our struct from ",Object(o.mdx)("a",{parentName:"p",href:"/docs/Tutorials/Kitties/create-kitties#a-what-information-to-include"},"step 1A"),", we can deduce the following types: ",Object(o.mdx)("strong",{parentName:"p"},Object(o.mdx)("inlineCode",{parentName:"strong"},"Hash"))," for ",Object(o.mdx)("inlineCode",{parentName:"p"},"id")," and ",Object(o.mdx)("inlineCode",{parentName:"p"},"dna"),"; ",Object(o.mdx)("strong",{parentName:"p"},Object(o.mdx)("inlineCode",{parentName:"strong"},"Balance"))," for ",Object(o.mdx)("inlineCode",{parentName:"p"},"price"),"; and ",Object(o.mdx)("strong",{parentName:"p"},Object(o.mdx)("inlineCode",{parentName:"strong"},"Gender"))," for ",Object(o.mdx)("inlineCode",{parentName:"p"},"gender"),"."),Object(o.mdx)("p",null,"For ",Object(o.mdx)("inlineCode",{parentName:"p"},"Gender"),", we'll need to build out our own custom enum and helper functions. Similarly, ",Object(o.mdx)("inlineCode",{parentName:"p"},"Balance"),"\nwill be something we'll later define in our configuration trait. However, we can start by importing\nthe ",Object(o.mdx)("inlineCode",{parentName:"p"},"Hash")," types from the ",Object(o.mdx)("inlineCode",{parentName:"p"},"frame_support")," library to satisfy ",Object(o.mdx)("inlineCode",{parentName:"p"},"id")," and ",Object(o.mdx)("inlineCode",{parentName:"p"},"dna"),"."),Object(o.mdx)("p",null,"Write this at the top of your pallet where\nthe dependencies are declared:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-rust"},"    use frame_support::sp_runtime::traits::{Hash};\n")),Object(o.mdx)("p",null,"In doing so, you've given your pallet access to Substrate's ",Object(o.mdx)("a",{parentName:"p",href:"https://substrate.dev/rustdocs/latest/sp_runtime/traits/trait.Hash.html"},Object(o.mdx)("inlineCode",{parentName:"a"},"Hash"))," type which will be the type for your Kitty ID and DNA."),Object(o.mdx)("div",{className:"admonition admonition-tip alert alert--success"},Object(o.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(o.mdx)("h5",{parentName:"div"},Object(o.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Your turn!")),Object(o.mdx)("div",{parentName:"div",className:"admonition-content"},Object(o.mdx)("p",{parentName:"div"},"Now that you know the different types your ",Object(o.mdx)("inlineCode",{parentName:"p"},"Kitty")," struct will require, start writing it!"),Object(o.mdx)("p",{parentName:"div"},"Your struct declaration will look like this: ",Object(o.mdx)("inlineCode",{parentName:"p"},"pub struct Kitty<Hash, Balance> {}")," and include the fields we went over in the previous section."),Object(o.mdx)("p",{parentName:"div"},Object(o.mdx)("strong",{parentName:"p"},"HINT"),": Have a look at ",Object(o.mdx)("a",{parentName:"p",href:"../../pallet-design/storage-value-struct"},"this how-to guide")," in case you get stuck."))),Object(o.mdx)("h4",{id:"d-adding-the-custom-gender-dependency"},"D. Adding the custom ",Object(o.mdx)("inlineCode",{parentName:"h4"},"Gender")," dependency"),Object(o.mdx)("p",null,"We've just created a struct that requires a custom type called ",Object(o.mdx)("inlineCode",{parentName:"p"},"Gender"),". This type will handle an enum defining our Kitty's gender. To create it, you'll build out the following parts:"),Object(o.mdx)("ol",null,Object(o.mdx)("li",{parentName:"ol"},Object(o.mdx)("strong",{parentName:"li"},"An enum declaration"),", which specifies ",Object(o.mdx)("inlineCode",{parentName:"li"},"Male")," and ",Object(o.mdx)("inlineCode",{parentName:"li"},"Female")," values."),Object(o.mdx)("li",{parentName:"ol"},Object(o.mdx)("strong",{parentName:"li"},"A function to configure a defaut value"),", based on the enum.")),Object(o.mdx)("div",{className:"admonition admonition-info alert alert--info"},Object(o.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(o.mdx)("h5",{parentName:"div"},Object(o.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),Object(o.mdx)("div",{parentName:"div",className:"admonition-content"},Object(o.mdx)("p",{parentName:"div"},"Setting up our ",Object(o.mdx)("inlineCode",{parentName:"p"},"Gender")," enum using a function to configure its default value will allow us to derive a Kitty's gender by passing in the randomness\ncreated by each Kitty's DNA."))),Object(o.mdx)("h4",{id:"e-enums"},"E. Enums"),Object(o.mdx)("p",null,"Writing enums requires us to use the ",Object(o.mdx)("a",{parentName:"p",href:"https://doc.rust-lang.org/reference/procedural-macros.html#derive-macros"},"derive macro")," which must precede the enum declaration."),Object(o.mdx)("p",null,"A typical enum would be structured as such:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-rust"},"    #[derive(Encode, Decode, Debug, Clone, PartialEq)]\n    pub enum TypicalEnum {\n        One,\n        Two,\n    }\n")),Object(o.mdx)("p",null,"Then, we can write out the default implementation by using Rust's ",Object(o.mdx)("a",{parentName:"p",href:"https://doc.rust-lang.org/std/default/trait.Default.html"},Object(o.mdx)("inlineCode",{parentName:"a"},"Default")," trait"),".\nThis would look something like this:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-rust"},"    impl Default for TypicalEnum {\n        fn default() -> Self {\n            TypicalEnum::One\n        }\n    }\n")),Object(o.mdx)("blockquote",null,Object(o.mdx)("p",{parentName:"blockquote"},"\ud83d\udca1 ",Object(o.mdx)("strong",{parentName:"p"},"It's like saying:")," let's give our enum a special trait that allows us to initialize it to a specific value.")),Object(o.mdx)("p",null,"Great, we now know how to create a custom struct and specify its default value. But what about providing\na way for a Kitty struct to be assigned a gender value? For that we need to learn one more thing."),Object(o.mdx)("h4",{id:"f-configuring-functions-for-our-kitty-struct"},"F. Configuring functions for our Kitty struct"),Object(o.mdx)("p",null,"Configuring a struct is useful in order to pre-define a value in our struct. For example, if we want to\nset a value according to what another function returns. In our case we have a similar situation where\nwe need to configure our Kitty struct in such a way that sets ",Object(o.mdx)("inlineCode",{parentName:"p"},"Gender")," according to a Kitty's DNA. We'll\nonly be using this function when we get to creating Kitties but let's first learn how to write it and get it out\nof the way."),Object(o.mdx)("p",null,"When you're implementing the configuration trait for a struct inside a FRAME pallet, you're doing the\nsame type of thing as implementing some trait for an enum except you're implementing the generic\nconfiguration trait, ",Object(o.mdx)("inlineCode",{parentName:"p"},"Config"),"."),Object(o.mdx)("p",null,"Building off our previous example, this would look like:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-rust"},"impl<T: Config> TypicalEnum {\n        pub fn special_function(some_hash: T::Hash) -> TypicalEnum {\n            if some_hash.as_ref()[0] % 2 == 0 {\n                TypicalEnum::One\n            } else {\n                TypicalEnum::Two\n            }\n        }\n    }\n")),Object(o.mdx)("p",null,"Now whenever ",Object(o.mdx)("inlineCode",{parentName:"p"},"special_function")," is called inside our pallet, it will return the enum value associated with\nthe function's logic."),Object(o.mdx)("div",{className:"admonition admonition-tip alert alert--success"},Object(o.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(o.mdx)("h5",{parentName:"div"},Object(o.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Your turn!")),Object(o.mdx)("div",{parentName:"div",className:"admonition-content"},Object(o.mdx)("p",{parentName:"div"},"Write out the ",Object(o.mdx)("inlineCode",{parentName:"p"},"Gender")," enum, trait implementations and ",Object(o.mdx)("inlineCode",{parentName:"p"},"Config")," implementation to define the behaviour\nof ",Object(o.mdx)("inlineCode",{parentName:"p"},"Gender")," for our ",Object(o.mdx)("inlineCode",{parentName:"p"},"Kitties")," struct."),Object(o.mdx)("p",{parentName:"div"},Object(o.mdx)("strong",{parentName:"p"},"Hint"),": reuse the logic in ",Object(o.mdx)("inlineCode",{parentName:"p"},"special_function")," ","\u2014"," that's how we'll retrieve the gender of our Kitties!"))),Object(o.mdx)("h3",{id:"2-implement-on-chain-randomness"},"2. Implement on-chain randomness"),Object(o.mdx)("p",null,"If we want to be able to tell these Kitties apart, we need to start giving them unique properties!\nFor our dApp, we need to generate a unique ID for each Kitty and some random DNA."),Object(o.mdx)("p",null,"We'll be using the ",Object(o.mdx)("a",{parentName:"p",href:"https://substrate.dev/rustdocs/latest/frame_support/traits/trait.Randomness.html"},"Randomness trait")," from ",Object(o.mdx)("inlineCode",{parentName:"p"},"frame_support")," to generate a random seed which we'll need\nto breed and create new unique Kitties. Alongside this trait, we'll also need a nonce which we'll create as a separate function\nand a hashing function which we'll get by using the ",Object(o.mdx)("a",{parentName:"p",href:"https://substrate.dev/rustdocs/latest/sp_runtime/traits/trait.Hash.html"},Object(o.mdx)("inlineCode",{parentName:"a"},"Hash")," trait")," that we imported in ",Object(o.mdx)("a",{parentName:"p",href:"/docs/Tutorials/Kitties/create-kitties#c-adding-the-hash-dependency"},"step 1C"),"."),Object(o.mdx)("p",null,"Here's what our random hashing function looks like:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-rust"},"        fn random_hash(sender: &T::AccountId) -> T::Hash {\n            let nonce = <Nonce<T>>::get();\n            let seed = T::Randomness::random_seed();\n\n            T::Hashing::hash_of(&(seed, &sender, nonce))\n        }\n")),Object(o.mdx)("p",null,"In order to implement the ",Object(o.mdx)("inlineCode",{parentName:"p"},"Randomness")," trait for our runtime, we must:"),Object(o.mdx)("p",null,Object(o.mdx)("strong",{parentName:"p"},"A. Specify it in our pallet's configuration trait.")),Object(o.mdx)("p",null,"The ",Object(o.mdx)("inlineCode",{parentName:"p"},"Randomness")," trait from ",Object(o.mdx)("inlineCode",{parentName:"p"},"frame_support")," requires specifying it with a paramater to replace the ",Object(o.mdx)("inlineCode",{parentName:"p"},"Output")," generic.\nTake a look at the documentation and the source code implementation to understand how this works. For our purposes,\nwe want the output of functions using this trait to be ",Object(o.mdx)("a",{parentName:"p",href:"https://substrate.dev/rustdocs/latest/sp_core/struct.H256.html"},Object(o.mdx)("inlineCode",{parentName:"a"},"H256")),":"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-rust"},"type KittyRandomness: Randomness<H256>;\n")),Object(o.mdx)("p",null,Object(o.mdx)("strong",{parentName:"p"},"B. Specify it for our runtime.")),Object(o.mdx)("p",null,"Given that we're adding a new type for the configuration of our pallet, we need to tell our runtime about its implementation.\nThis could come in handy if ever we wanted to change the algorithm that ",Object(o.mdx)("inlineCode",{parentName:"p"},"KittyRandomness")," is using, without needing to\nmodify where it's used inside our pallet."),Object(o.mdx)("p",null,"To showcase this point, we're going to implement ",Object(o.mdx)("inlineCode",{parentName:"p"},"KittyRandomness")," by assigning it to an instance of ",Object(o.mdx)("a",{parentName:"p",href:"https://substrate.dev/rustdocs/latest/pallet_randomness_collective_flip/index.html"},"FRAME's ",Object(o.mdx)("inlineCode",{parentName:"a"},"RandomnessCollectiveFlip")),".\nThis requires you to integrate the ",Object(o.mdx)("inlineCode",{parentName:"p"},"RandomnessCollectiveFlip")," pallet to your runtime and implement it. Once you do that, inside your\n",Object(o.mdx)("inlineCode",{parentName:"p"},"runtime/src/lib.rs")," file, include the ",Object(o.mdx)("inlineCode",{parentName:"p"},"KittyRandomness")," type for your runtime:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-rust"},"impl pallet_kitties::Config for Runtime {\n    type KittyRandomness = RandomCollectiveFlip;\n}\n")),Object(o.mdx)("div",{className:"admonition admonition-tip alert alert--success"},Object(o.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(o.mdx)("h5",{parentName:"div"},Object(o.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),Object(o.mdx)("div",{parentName:"div",className:"admonition-content"},Object(o.mdx)("p",{parentName:"div"},"Check out this ",Object(o.mdx)("a",{parentName:"p",href:"/docs/pallet-design/randomness"},"how-to guide")," on implementing randomness in case you get stuck."))),Object(o.mdx)("h4",{id:"nonce"},"Nonce"),Object(o.mdx)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(o.mdx)("h5",{parentName:"div"},Object(o.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"why our random hashing function needs a nonce")),Object(o.mdx)("div",{parentName:"div",className:"admonition-content"},Object(o.mdx)("p",{parentName:"div"},"Our goal is to create as much entropy as we can for ",Object(o.mdx)("inlineCode",{parentName:"p"},"hash_of")," to produce enough randomness when creating Kitty IDs and DNA.\nSince ",Object(o.mdx)("inlineCode",{parentName:"p"},"random_seed()")," does not change for multiple transactions in the same\nblock, and since it may not even generate a\nrandom seed for the first 80 blocks, we need to create a nonce for our pallet to manage and use in our private ",Object(o.mdx)("inlineCode",{parentName:"p"},"random_hash")," function.  "))),Object(o.mdx)("p",null,"We'll use the nonce provided by ",Object(o.mdx)("a",{parentName:"p",href:"https://substrate.dev/rustdocs/latest/frame_system/struct.AccountInfo.html#structfield.nonce"},Object(o.mdx)("inlineCode",{parentName:"a"},"frame_system::AccountInfo"))," and create a storage item to keep track of it as we modify it."),Object(o.mdx)("p",null,"So we'll need to do a couple things."),Object(o.mdx)("p",null,"First, create a storage item for the nonce value:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-rust"},"    #[pallet::storage]\n    #[pallet::getter(fn get_nonce)]\n    pub(super) type Nonce<T: Config> = StorageValue<_, u64, ValueQuery>;\n")),Object(o.mdx)("p",null,"Second, create a function that increments the nonce:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-rust"},"fn increment_nonce() -> DispatchResult {\n            <Nonce<T>>::try_mutate(|nonce| {\n                let next = nonce.checked_add(1).ok_or(Error::<T>::NonceOverflow)?;\n                *nonce = next;\n\n                Ok(().into())\n            })\n        }\n")),Object(o.mdx)("div",{className:"admonition admonition-tip alert alert--success"},Object(o.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(o.mdx)("h5",{parentName:"div"},Object(o.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},Object(o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Your turn!")),Object(o.mdx)("div",{parentName:"div",className:"admonition-content"},Object(o.mdx)("p",{parentName:"div"},"Feel free to use the code snippets above. Make sure to\ninclude the ",Object(o.mdx)("inlineCode",{parentName:"p"},"Nonce")," storage item among the section with your other storage items, and the\n",Object(o.mdx)("inlineCode",{parentName:"p"},"increment_nonce()")," function in the helper function section."))),Object(o.mdx)("h4",{id:"unique-kitty-id"},"Unique Kitty ID"),Object(o.mdx)("p",null,"To easily track all of our kitties, it would be helpful to standardize our logic to use a unique id as the global key\nfor our storage items. This means that a single unique key will point to our Kitty object, and all other links to ownership\nwill point to that key."),Object(o.mdx)("p",null,"The ID on the Kitty object will serve that purpose, but we need to make sure that the ID for a new Kitty is always unique.\nWe can do this with a new storage item ",Object(o.mdx)("inlineCode",{parentName:"p"},"Kitties")," which will be a mapping from an ID (Hash) to the Kitty object."),Object(o.mdx)("p",null,"With this object, we can easily check for collisions by simply checking whether this storage item already contains a mapping\nusing a particular ID. For example, from inside a dispatchable function we could check using:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-rust"},'ensure!(!<Kitties<T>>::exists(new_id), "This new id already exists");\n')),Object(o.mdx)("p",null,"You'll be implementing the ",Object(o.mdx)("inlineCode",{parentName:"p"},"StorageMap")," for ",Object(o.mdx)("inlineCode",{parentName:"p"},"Kitties")," in the next section."),Object(o.mdx)("h3",{id:"3-include-storage-items"},"3. Include storage items"),Object(o.mdx)("p",null,"We'll be needing a total of 9 storage items\nfor our Kitty pallet. We already included ",Object(o.mdx)("inlineCode",{parentName:"p"},"Nonce")," and we've already created the basis for\nour Kitty object ","\u2014"," we just need to implement a way to keep track of them now!"),Object(o.mdx)("p",null,"Our pallet's logic can best be understood\nby examining the storage items we'll be using. In other words, the way we define the conditions\nfor reading and writing to our runtime's storage\nhelps us breakdown the items we'll need to enable NFT capabilities. In our case, we care about state transitions and persistance around two main concepts our runtime needs to be made aware of:"),Object(o.mdx)("ol",null,Object(o.mdx)("li",{parentName:"ol"},"unique assets, like currency or Kitties"),Object(o.mdx)("li",{parentName:"ol"},"helper datastructures, like the nonce, counters or account maps")),Object(o.mdx)("p",null,"This already starts to lay the foundations for our Kitty pallet logic. But there's an important layer beneath these two concepts: our runtime needs to have a sense of asset ownership as well as the ability to keep track of changes in ownership and owned quantities."),Object(o.mdx)("p",null,"In our application, ontop of keeping a single storage instance for Kitty objects, we need a number of storage items to keep track of:"),Object(o.mdx)("ul",null,Object(o.mdx)("li",{parentName:"ul"},"Kitties in existence"),Object(o.mdx)("li",{parentName:"ul"},"Owned Kitties")),Object(o.mdx)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(o.mdx)("h5",{parentName:"div"},Object(o.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"The overarching pattern here is to keep track of ",Object(o.mdx)("em",{parentName:"h5"},"who")," and ",Object(o.mdx)("em",{parentName:"h5"},"what"),".")),Object(o.mdx)("div",{parentName:"div",className:"admonition-content"},Object(o.mdx)("p",{parentName:"div"},"This boils down to the following storage items (in addition to ",Object(o.mdx)("inlineCode",{parentName:"p"},"Kitties")," and ",Object(o.mdx)("inlineCode",{parentName:"p"},"Nonce"),"):"),Object(o.mdx)("p",{parentName:"div"},Object(o.mdx)("strong",{parentName:"p"},"Tracking ownership")),Object(o.mdx)("ul",{parentName:"div"},Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("inlineCode",{parentName:"li"},"<KittyOwner<T>>"),": Keeps track of what accounts own what Kitty."),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("inlineCode",{parentName:"li"},"<OwnedKittiesArray<T>>"),": Keep track of who a Kitty is owned by."),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("inlineCode",{parentName:"li"},"<OwnedKittiesCount<T>>"),": Keeps track of the total amount of Kitties owned."),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("inlineCode",{parentName:"li"},"<OwnedKittiesIndex<T>>"),": Keeps track of all owned Kitties by index.")),Object(o.mdx)("p",{parentName:"div"},Object(o.mdx)("strong",{parentName:"p"},"Tracking existing Kitties")),Object(o.mdx)("ul",{parentName:"div"},Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("inlineCode",{parentName:"li"},"<AllKittiesArray<T>>"),": An index to track of all Kitties."),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("inlineCode",{parentName:"li"},"<AllKittiesCount<T>>"),": Stores the total amount of Kitties in existence."),Object(o.mdx)("li",{parentName:"ul"},Object(o.mdx)("inlineCode",{parentName:"li"},"<AllKittiesIndex<T>>"),": Keeps track of all the Kitties.\n:::")),Object(o.mdx)("h4",{parentName:"div",id:"using-a-storagemap"},"Using a ",Object(o.mdx)("inlineCode",{parentName:"h4"},"StorageMap")),Object(o.mdx)("p",{parentName:"div"},"Every storage item declaration will follow a similar\npattern as when we wrote the storage item for ",Object(o.mdx)("inlineCode",{parentName:"p"},"Nonce"),". The only difference is which data structure type each storage item requires."),Object(o.mdx)("p",{parentName:"div"},"To create a storage instance for the Kitty struct,\nwe'll be using ",Object(o.mdx)("inlineCode",{parentName:"p"},"StorageMap")," ","\u2014"," a hash-map provided\nto us by FRAME. This differs from the storage instance we created for\n",Object(o.mdx)("inlineCode",{parentName:"p"},"Nonce")," which, because we want it to keep track of a single ",Object(o.mdx)("inlineCode",{parentName:"p"},"u64")," value, we used ",Object(o.mdx)("inlineCode",{parentName:"p"},"StorageValue"),". Here, we need our storage to keep track\nof the mapping hash IDs and Kitty objects."),Object(o.mdx)("p",{parentName:"div"},"Here's the basic pattern for declaring a storage map storage item, showing the storage for Kitty objects as an example:"),Object(o.mdx)("pre",{parentName:"div"},Object(o.mdx)("code",{parentName:"pre",className:"language-rust"},"    #[pallet::storage]\n    #[pallet::getter(fn kitty)]\n    pub(super) type Kitties<T: Config> =\n        StorageMap<_, Twox64Concat, T::Hash, Kitty<T::Hash, T::Balance>, ValueQuery>;\n")),Object(o.mdx)("p",{parentName:"div"},"Breaking it down, we declare the storage type and assign a ",Object(o.mdx)("inlineCode",{parentName:"p"},"StorageMap")," that takes:"),Object(o.mdx)("ul",{parentName:"div"},Object(o.mdx)("li",{parentName:"ul"},"The ",Object(o.mdx)("a",{parentName:"li",href:"https://substrate.dev/rustdocs/latest/frame_support/struct.Twox64Concat.html"},Object(o.mdx)("inlineCode",{parentName:"a"},"Twox64Concat"))," hashing algorithm."),Object(o.mdx)("li",{parentName:"ul"},"A key of type ",Object(o.mdx)("inlineCode",{parentName:"li"},"T::Hash"),"."),Object(o.mdx)("li",{parentName:"ul"},"A value of type ",Object(o.mdx)("inlineCode",{parentName:"li"},"Kitty<T::Hash, T::Balance>"),".")))),Object(o.mdx)("p",null,"Use the storage items outlined above to help you finish writing the remaining storage items. Follow the same pattern\nwe used for ",Object(o.mdx)("inlineCode",{parentName:"p"},"Nonce")," and ",Object(o.mdx)("inlineCode",{parentName:"p"},"Kitties")," ","\u2014"," just remember what type each item is meant to store!"),Object(o.mdx)("p",null,Object(o.mdx)("strong",{parentName:"p"},"HINT"),": Remember to include a getter function for each storage item ","\u2014"," except those handling indices) .\n:::"),Object(o.mdx)("p",null,"Assuming you've finished implementing all of your storage items, now's a good time to check that your pallet compiles correctly:"),Object(o.mdx)("pre",null,Object(o.mdx)("code",{parentName:"pre",className:"language-rust"},"cargo build -p pallet-kitties\n")),Object(o.mdx)("div",{className:"admonition admonition-note alert alert--secondary"},Object(o.mdx)("div",{parentName:"div",className:"admonition-heading"},Object(o.mdx)("h5",{parentName:"div"},Object(o.mdx)("span",{parentName:"h5",className:"admonition-icon"},Object(o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},Object(o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"Congratulations!")),Object(o.mdx)("div",{parentName:"div",className:"admonition-content"},Object(o.mdx)("p",{parentName:"div"},"If you've made it this far, you now have the foundations for your pallet to\nhandle the creation and ownership of your Kitties! In this part of the tutorial, we've learnt:"),Object(o.mdx)("ul",{parentName:"div"},Object(o.mdx)("li",{parentName:"ul"},"How to write a struct and use it in a ",Object(o.mdx)("inlineCode",{parentName:"li"},"StorageMap"),"."),Object(o.mdx)("li",{parentName:"ul"},"How to implement a custom type."),Object(o.mdx)("li",{parentName:"ul"},"How to set a default enum value for a custom type."),Object(o.mdx)("li",{parentName:"ul"},"How to create a function to set a value for that custom type."),Object(o.mdx)("li",{parentName:"ul"},"How to implement the Randomness trait to write a function that generates randomness using a nonce."),Object(o.mdx)("li",{parentName:"ul"},"How to write ",Object(o.mdx)("inlineCode",{parentName:"li"},"StorageMap")," storage items.")))),Object(o.mdx)("h2",{id:"next-steps"},"Next steps"),Object(o.mdx)("ul",null,Object(o.mdx)("li",{parentName:"ul"},"Create a dispatchable function that mints a new Kitty"),Object(o.mdx)("li",{parentName:"ul"},"Create a helper function to handle storage updates"),Object(o.mdx)("li",{parentName:"ul"},"Create and use Events")))}m.isMDXComponent=!0}}]);